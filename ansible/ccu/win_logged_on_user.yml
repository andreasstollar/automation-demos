---
- name: Get logged-in users on Windows
  hosts: all
  gather_facts: no

  tasks:
    - name: Run 'quser' to get logged-in users
      ansible.windows.win_shell: quser
      register: quser_output
      ignore_errors: yes

    - name: Check if any users are logged in
      ansible.builtin.set_fact:
        has_users: "{{ quser_output.stdout is defined and quser_output.stdout | trim | length > 0 }}"

    - name: Show list of logged-in users
      ansible.builtin.debug:
        msg: "{{ quser_output.stdout_lines }}"
      when: has_users

    - name: Show message if no users are logged in
      ansible.builtin.debug:
        msg: "No users are currently logged in."
      when: not has_users